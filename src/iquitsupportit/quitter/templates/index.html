{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Support {{ profile.user.first_name }} for quitting smoking by supporting {{ profile.current_beneficiary.name }}{% endblock %}
{% block content %}
<div class="pure-g-r">
    <div class="pure-u-2-5">
        <div class="hello-box">
            <h1>Hello</h1>
            <h2>My name is</h2>
            <div class="name">
            {{ profile.user.first_name }}
            </div>
        </div>
    </div>
    <div class="pure-u-3-5">
        <div id="since-box">
            <div id="since-message">I haven't smoked for</div>
            <div id="clock"></div>
            <div id="charity-box">
                and {{ profile.donation_percentage }}% of what I save goes to
            </div>
        </div>
    </div>
</div>
<div class="pure-g-r">
    <div class="pure-u-1">
        <div id="beneficiary-box">
             <div id="beneficiary"><a href="{{ profile.current_beneficiary.url }}" target="_blank">{{ profile.current_beneficiary.name }}</a></div>
             with your help, I've raised
             <div id="total-amount">${{ profile.total_amount|floatformat:"0" }}</div>
             <div id="copyright">&copy;{{ profile.current_beneficiary.name }}</div>
        </div>
    </div>
</div>
<div class="pure-g-r">
    <div class="pure-u-3-5">
        <div id="testimony-box">
            {{ profile.testimony|linebreaks }}
        </div>
    </div>
    <div class="pure-u-2-5">
        <div id="media-box">
            {% autoescape off %}
            {{ profile.video_snippet }}
            {% endautoescape %}
        </div>
    </div>
</div>
<div class="pure-g-r">
    <div class="pure-u-1-3">
        <div id="donations-box">
            <h1>Donations</h1>
            <div id="donations-chart" style="width: 280px; height: 280px;"></div>
        </div>
    </div>
    <div class="pure-u-1-3">
        <div id="pledge-box">
            <h1>Support us</h1>
            <form action="{% url "pledge_create" profile.current_beneficiary.id %}" method="post" id="pledge-form" class="pure-form">
            <div class="pure-g-r">
                <div class="pure-u-2-5">
                <label for="id_days">when I reach</label>
                </div>
                <div class="pure-u-3-5">
                {{ form.days }}
                </div>
            </div>
            <div class="pure-g-r">
                <div class="pure-u-2-5">
                <label for="id_amount">you'll donate</label>
                </div>
                <div class="pure-u-3-5">
                {{ form.amount }}
                </div>
            </div>
            <div class="pure-g-r">
                <div class="pure-u-2-5">
                <label for="id_email">Remind you at</label>
                </div>
                <div class="pure-u-3-5">
                {{ form.email }}
                </div>
            </div>
            <div id="donate-button"><input type="submit" value="Pledge to donate"/></div>
            <div id="pledge-disclaimer">This is a pledge, I'll receive no money. First, you will receive an email to validate
            your address. When I've reached the goal you set, you will receive another email with a link to the charity website
            and a button to confirm your donation.</div>
            </form>
            <div id="pledge-loading"></div>
            <div id="pledge-result">
                <div class="message"></div>
            </div>
        </div>
    </div>
    <div class="pure-u-1-3">
        <div id="info-box">
            <h1>Share</h1>
            <div id="help">Help me, help them</div>
            <div id="logo"><a href="{{ profile.current_beneficiary.url }}" target="_blank"><img src="{% static "img/logo.gif" %}" /></a></div>
            <div id="spread">Spread the word</div>
            <div id="share-buttons">
                <span class='st_facebook_large' displayText='Facebook'></span>
                <span class='st_twitter_large' displayText='Tweet'></span>
                <span class='st_googleplus_large' displayText='Google +'></span>
                <span class='st_pinterest_large' displayText='Pinterest'></span>
                <span class='st_email_large' displayText='Email'></span>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
var clock = $('#clock').FlipClock({
    clockFace: 'DailyCounter',
    showSeconds: false,
    autoStart: false
});
clock.setTime({{ profile.duration_in_sec }});
clock.start();

$('#pledge-form').submit(function(e){
    e.preventDefault();
    $('#pledge-form').hide();
    $('#pledge-loading').show();
    var form = e.target;
    var data = {}
    $.each($(form).serializeArray(), function(){
        data[this.name] = this.value
    });
    $.post($(form).attr('action'), data, function(response){
        if (response.status) {
            $('#pledge-result .message').html(response.message);
            $('#pledge-loading').hide();
            $('#pledge-result').show();
        } else {
            $.each(response.errors, function(key, errors){
                $('#id_' + key).after('<small class="error">' + errors.join(' ') + '</small>');
                $('#pledge-loading').hide();
                $('#pledge-form').show();
            });
        }
    });
});
</script>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
      ['Origin', 'Amount (in $)'],
      ['My donations',  {{ profile.amount_pledged|floatformat:"0" }}],
      ['Your donations',  {{ profile.supporter_donations }}],
      ['Your pledges', {{ profile.supporter_pledges }}],
    ]);

  var options = {
    legend: 'none',
    pieSliceText: 'label',
    chartArea:{left:10,top:10,width:"90%",height:"90%"},
    fontSize: 12,
    slices: [{color: '#5C8727'}, {color: '#FF9900'}, {color: '#DC3912'}]
  };

    var chart = new google.visualization.PieChart(document.getElementById('donations-chart'));
    chart.draw(data, options);
  }
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8184167-4', 'iquitsupport.us');
  ga('send', 'pageview');
</script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "5a92aa43-cf36-4fba-9863-59aed8b2a340", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>
{% endblock %}
